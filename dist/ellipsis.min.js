/*! Ellipsis - v0.1.0 - 2012-12-11
* https://github.com/wilsonpage/ellipsis
* Copyright (c) 2012 Wilson Page; Licensed MIT */
(function(e){"use strict";function n(e,t){return parseInt(e.getPropertyValue(t+"column-count"),10)||1}function r(e){var t=parseInt(e.getPropertyValue("line-height"),10);return t?t:console.error("The ellipsis container must have line-height set on it")}function i(e){return window.getComputedStyle(e)}function s(e){return[e.offsetWidth,e.offsetHeight]}function o(e,t){return e.offsetTop<4&&t.deltaHeight>t.lineHeight/2}function u(e){var t,n,r,i,s,u,a,f,l={},c=e.el.children,h=0,p=0;for(t=0,n=c.length;t<n;t++){h+=r=c[t].offsetHeight,u=Math.floor(h/e.columnHeight);if(h>=e.totalHeight){l.el=c[t];break}p=u}if(!l.el)return;return a=e.columnCount-p,i=h-e.totalHeight,s=r-i,l.cappedLines=Math.floor((s-a*e.deltaHeight)/e.lineHeight),l.cappedHeight=l.cappedLines*e.lineHeight+(a-1)*e.deltaHeight,l.applyTopMargin=o(l.el,e),l}function a(e){if(!e||!e.el)return;e.el.style.height=e.cappedHeight+"px",e.el.style.webkitLineClamp=e.cappedLines,e.el.style.display="-webkit-box",e.el.style.webkitBoxOrient="vertical",e.applyTopMargin&&(e.el.style.marginTop="1em"),e.el.classList.add("overflowing-child")}function f(e){if(!e||!e.el)return;e.el.style.height="",e.el.style.webkitLineClamp="",e.el.style.display="",e.el.style.webkitBoxOrient="",e.el.classList.remove("overflowing-child")}function l(e){if(!e)return;this.el=e}var t=function(){var e=document.createElement("div"),t=["Webkit","Moz","O","ms"],n=["-webkit-","-moz-","-o-","-ms-"];for(var r=0;r<t.length;r++)if(t[r]+"ColumnCount"in e.style)return n[r];return"columnCount"in e.style?"":!1}();e.Ellipsis=l,l.prototype.calc=function(){l.profile&&console.profile("ellipsis.calc");var e=i(this.el),o=s(this.el);return this.columnHeight=o[1],this.columnCount=n(e,t),this.lineHeight=r(e),this.deltaHeight=o[1]%this.lineHeight,this.totalHeight=o[1]*this.columnCount,this.overflowingChild=u(this),l.profile&&console.profileEnd("ellipsis.calc"),this},l.prototype.set=function(){return l.profile&&console.profile("ellipsis.set"),a(this.overflowingChild),l.profile&&console.profileEnd("ellipsis.set"),this},l.prototype.unset=function(){return l.profile&&console.profile("ellipsis.unset"),f(this.overflowingChild),this.overflowingChild=null,l.profile&&console.profileEnd("ellipsis.unset"),this},l.prototype.destroy=function(){return this.el=this.overflowingChild=null,this}})(this);