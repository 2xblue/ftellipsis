/*! Ellipsis - v0.1.0 - 2012-12-13
* https://github.com/wilsonpage/ellipsis
* Copyright (c) 2012 Wilson Page; Licensed MIT */
(function(e){"use strict";function r(e,t){return parseInt(e.getPropertyValue(t+"column-count"),10)||1}function i(e){var t=parseInt(e.getPropertyValue("line-height"),10);return t?t:console.error("The ellipsis container must have line-height set on it")}function s(e){return window.getComputedStyle(e)}function o(e){return[e.offsetWidth,e.offsetHeight]}function u(e,t){return e.offsetTop<4&&t.deltaHeight>t.lineHeight/2}function a(e){var t,n,r,i,s,o,a,f,l={},c=e.el.children,h=0,p=0;for(t=0,n=c.length;t<n;t++){h+=r=c[t].offsetHeight,o=Math.floor(h/e.columnHeight);if(h>=e.totalHeight){l.el=c[t];break}p=o}if(!l.el)return;return a=e.columnCount-p,i=h-e.totalHeight,s=r-i,l.cappedLines=Math.floor((s-a*e.deltaHeight)/e.lineHeight),l.cappedHeight=l.cappedLines*e.lineHeight+(a-1)*e.deltaHeight,l.applyTopMargin=u(l.el,e),l}function f(e){if(!e||!e.el)return;e.el.style.height=e.cappedHeight+"px",e.el.style.webkitLineClamp=e.cappedLines,e.el.style.display="-webkit-box",e.el.style.webkitBoxOrient="vertical",e.applyTopMargin&&(e.el.style.marginTop="1em"),e.el.classList.add("overflowing-child")}function l(e){if(!e||!e.el)return;e.el.style.height="",e.el.style.webkitLineClamp="",e.el.style.display="",e.el.style.webkitBoxOrient="",e.el.classList.remove("overflowing-child")}function c(e,t){e.style[n+"box-flex"]=t,e.style[n+"flex"]=t}function h(e){e.style.display="none",setTimeout(function(){e.style.display=""},0)}function p(e,n){var r=n&&n.display,i=e.parentNode.children,s=t.call(i,e);for(var o=s+1,u=i.length;o<u;o++)i[o].style.display=r}function d(e){if(!e)return;this.el=e}var t=Array.prototype.indexOf,n=function(){var e=document.createElement("div"),t=["Webkit","Moz","O","ms"],n=["-webkit-","-moz-","-o-","-ms-"];for(var r=0;r<t.length;r++)if(t[r]+"ColumnCount"in e.style)return n[r];return"columnCount"in e.style?"":!1}();e.Ellipsis=d,d.prototype.calc=function(){if(!this.el)return this;var e=s(this.el),t=o(this.el);return this.columnHeight=t[1],this.columnCount=r(e,n),this.lineHeight=i(e),this.deltaHeight=t[1]%this.lineHeight,this.totalHeight=t[1]*this.columnCount,this.overflowingChild=a(this),this},d.prototype.set=function(){return!this.el||!this.overflowingChild?this:(f(this.overflowingChild),p(this.overflowingChild.el,{display:"none"}),c(this.el,"0"),h(this.el),this)},d.prototype.unset=function(){return!this.el||!this.overflowingChild?this:(l(this.overflowingChild),p(this.overflowingChild.el,{display:""}),c(this.el,""),this.overflowingChild=null,this)},d.prototype.destroy=function(){return this.el=this.overflowingChild=null,this}})(this);